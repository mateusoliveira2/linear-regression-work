---
title: ""
author: "Fanny Batista Vieira, Marcus Vinícius de Farias Barbosa e Mateus de Lima Oliveira"
date: "13 de maio de 2019"
output:
  html_document:
    code_folding: "hide"
    toc: yes
    toc_depth: 5
    toc_float:
      collapsed: no
    df_print: paged
---

## Pergunta a ser respondida: Quais departamentos quando investidos interferem no lucro das startups ?

```{r}
library(tidyverse)
options(scipen = 999)

dataset = read_csv(here::here("data/50_startups.csv"),
                 col_types = "dddcd")
```

## Análise Descritiva

### Visualização dos dados
OBS: Inserir Heatmap

```{r}
library(ggplot2)
ggplot(data = dataset) +
  geom_point(aes(x = Administration, y = Profit, color = State)) +
  facet_grid(State ~ .) +
  ggtitle('Administration Spend X Profit')

ggplot(data = dataset) +
  geom_point(aes(x = Marketing, y = Profit, color = State)) +
  facet_grid(State ~ .) +
  ggtitle('Marketing Spend X Profit')

ggplot(data = dataset) +
  geom_point(aes(x = ReD, y = Profit, color = State)) +
  facet_grid(State ~ .) +
  ggtitle('ReD Spend X Profit')

ggplot(data = dataset) +
  geom_bar(aes(State, fill = State)) +
  ggtitle('Administration X Profit')

ggplot(data = dataset) +
  geom_point(aes(x = State, y = Profit, color = State))

```

### Análise da Correlação

```{r}
cor(dataset$Administration, dataset$Profit)
cor(dataset$Marketing, dataset$Profit)
cor(dataset$ReD, dataset$Profit)
```

## Modelo de Regressão e Análise da Variância (ANOVA)

### Backward Elimination

```{r}
regressor = lm(formula = Profit ~ Administration + Marketing + ReD, data = dataset)
summary(regressor)

regressor = lm(formula = Profit ~ Administration + ReD, data = dataset)
summary(regressor)

regressor = lm(formula = Profit ~ ReD, data = dataset)
summary(regressor)
```
### ANOVA

#### Função para análise de variância
```{r}
anova(regressor)
anovaTest = aov(regressor, data = dataset)
summary(anovaTest)
```

## Análise de Resíduos


```{r}
predicoes = predict(regressor)
residuos = residuals(regressor)

ggplot(dataset, aes(x = ReD, y = Profit)) +
  geom_smooth(method = "lm", se = FALSE, color = "lightgrey") +     # regression line  
  geom_segment(aes(xend = ReD, yend = predicoes), alpha = .2) +     # draw line from point to line
  geom_point(aes(color = abs(residuos), size = abs(residuos))) +    # size of the points
  scale_color_continuous(low = "green", high = "red") +             # colour of the points mapped to residual size - green smaller, red larger
  guides(color = FALSE, size = FALSE) +                             # size legend removed
  geom_point(aes(y = predicoes), shape = 1) +
  theme_bw() 
```

### Teste da linearidade

```{r}
plot(regressor, which=1, col=c("blue"))
```


### Teste de normalidade

```{r}
plot(regressor, which=2, col=c("blue"))
```

```{r}
plot(density(residuos))
```

```{r}
shapiro.test(residuos)
```

### Teste da homogeinidade

```{r}
plot(regressor, which=3, col=c("blue"))  # Scale-Location Plot
```

```{r}
library(lmtest)
bptest(regressor, studentize = F)
```

### Teste da independência

```{r}
library(car)
durbinWatsonTest(regressor)
```

