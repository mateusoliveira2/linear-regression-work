---
title: ""
author: "Fanny Batista Vieira, Marcus Vinícius de Farias Barbosa e Mateus de Lima Oliveira"
date: "13 de maio de 2019"
output:
  html_document:
    code_folding: "hide"
    toc: yes
    toc_depth: 5
    toc_float:
      collapsed: no
    df_print: paged
---

## Pergunta a ser respondida: Quais departamentos quando investidos interferem no lucro das startups ?

```{r}
library(tidyverse)
options(scipen = 999)

dataset = read_csv(here::here("data/50_startups.csv"),
                 col_types = "dddcd")
```

## Análise Descritiva

### Visualização dos dados
OBS: Inserir Heatmap

```{r}
library(ggplot2)
ggplot(data = dataset) +
  geom_point(aes(x = Administration, y = Profit, color = State)) +
  facet_grid(State ~ .) +
  ggtitle('Administration Spend X Profit')

ggplot(data = dataset) +
  geom_point(aes(x = Marketing, y = Profit, color = State)) +
  facet_grid(State ~ .) +
  ggtitle('Marketing Spend X Profit')

ggplot(data = dataset) +
  geom_point(aes(x = ReD, y = Profit, color = State)) +
  facet_grid(State ~ .) +
  ggtitle('ReD Spend X Profit')

ggplot(data = dataset) +
  geom_bar(aes(State, fill = State)) +
  ggtitle('Administration X Profit')

ggplot(data = dataset) +
  geom_point(aes(x = State, y = Profit, color = State))

```

### Análise da Correlação

```{r}
cor(dataset$Administration, dataset$Profit)
cor(dataset$Marketing, dataset$Profit)
cor(dataset$ReD, dataset$Profit)
```

## Modelo de Regressão e Análise da Variância (ANOVA)

### Backward Elimination

```{r}
regressor = lm(formula = Profit ~ Administration + Marketing + ReD, data = dataset)
summary(regressor)

regressor = lm(formula = Profit ~ Administration + ReD, data = dataset)
summary(regressor)

regressor = lm(formula = Profit ~ ReD, data = dataset)
summary(regressor)
```
### ANOVA

#### Função para análise de variância
```{r}
anova(regressor)
anovaTest = aov(regressor, data = dataset)
summary(anovaTest)
```

## Análise de Resíduos

Os resíduos representam as diferenças entre os valores do fenômeno que estamos observando, no nosso caso, são os valores que observamos no dataset. E os valores estimados, a partir do nosso modelo. De modo formal, um resíduo pode ser obtido pela seguinte fórmula:

```
    ei = yi - yi'
```

onde:  
ei -> indica o iésimo erro  
yi -> indica o iésimo valor observado  
yi'-> indica o iésimo valor estimado  

A análise dos resíduos, consiste em validar se o modelo adotado, de fato, é adequado para o contexto do problema, baseado nas suposições feitas para os dados, são elas: 

 - **Linearidade**: Esperamos que o dados tenha uma relação linear.  
 - **Normalidade**: Os resíduos devem ter seguir a distribuição normal, com média igual a 0 e variância constante.  
 - **Homogeneidade**: Os resíduos devem variar na mesma proporção. Desta forma, cada um contribui de forma igual para a soma dos quadrados.  
 - **Independência**: Um resíduo não deve influenciar o outro, essa suposição, garante que os dados foram coletados de modo aleatório no espaço amostral.                                                        
No gráfico abaixo, vemos os valores observados, representados pelas bolinhas menores ao longo da reta, e os valores estimados, indicados por bolas, nas cores verde e laranja, além disso, temos os resíduos, sendo representados pela linha entre a reta e os valores estimados. 

A partir dele, já conseguimos visualizar a existência da relação linear entre as variáveis, e como o modelo, consegue explicar boa parte dos dados, como foi visto utilizado a estatística `R²`, que teve valor igual a 94%, demonstrando assim, que conseguimos explicar 94% dos dados.

```{r}
predicoes = predict(regressor)
residuos = residuals(regressor)

ggplot(dataset, aes(x = ReD, y = Profit)) +
  geom_smooth(method = "lm", se = FALSE, color = "lightgrey") +     # regression line  
  geom_segment(aes(xend = ReD, yend = predicoes), alpha = .2) +     # draw line from point to line
  geom_point(aes(color = abs(residuos), size = abs(residuos))) +    # size of the points
  scale_color_continuous(low = "green", high = "red") +             # colour of the points mapped to residual size - green smaller, red larger
  guides(color = FALSE, size = FALSE) +                             # size legend removed
  geom_point(aes(y = predicoes), shape = 1) +
  theme_bw() 
```

### Teste da linearidade

```{r}
plot(regressor, which=1, col=c("blue"))
```


### Teste de normalidade

```{r}
plot(regressor, which=2, col=c("blue"))
```

```{r}
plot(density(residuos))
```

```{r}
shapiro.test(residuos)
```

### Teste da homogeinidade

```{r}
plot(regressor, which=3, col=c("blue"))  # Scale-Location Plot
```

```{r}
library(lmtest)
bptest(regressor, studentize = F)
```

### Teste da independência

```{r}
library(car)
durbinWatsonTest(regressor)
```

